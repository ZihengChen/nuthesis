\subsection{Data}
\label{sec:cms_data}

In this analysis, data is selected based on the presence of at least one
muon or one electron.  The single muon dataset requires that
events contain at least one muon with $p_{T} > 25\,\GeV$ and passing the
loose track isolation criterion, $\rm Iso_{track} < 0.1$.  The single
electron dataset requires that there be at least one electron satisfying
the requirement that $\pt > 30\,\GeV$ and that it pass the tight
identification requirements as defined by the EGamma
POG~\ref{sec:electrons}.  The specific dataset names and the associated
integrated luminosities are listed in Table~\ref{tab:data_2016}.

\input{tables/data_2016.tex}

Run ranges where data quality is determined to be insufficient are
filtered removed from the datset by applying a luminosity mask.  The
following file is provided in JSON format from the CMS PPD group:

\texttt{Cert\_271036-284044\_13TeV\_23Sep2016ReReco\_Collisions16\_JSON.txt}

The full dataset consists of 35.9 fb$^{-1}$ of integrated
luminosity~\cite{CMS-PAS-LUM-17-001}.

\subsection{Simulated datasets}
\label{sec:simulation}

Simulated datasets (MC) are used for modelling the signal process and
most of the background processes.  It is observed that simulation is
insufficient for modelling the background arising from multijet QCD.
Consequently, that background is estimated using data-driven techniques.
The details of the background estimation are presented in
section~\ref{sec:bg}.

The simulated samples used in modelling the background and signal are
shown in table~\ref{tab:mc}.  The production of the samples was carried
during the Summer 16 campaingn and the production of the
\texttt{miniAOD} datasets was done using CMSSW release 8.0.26.patch2.
The same release was used for processing both the data and the simulated
samples.

\input{tables/mc_2016.tex}

Lepton universality is assumed for the simulated datasets, i.e., $\sf
\mathcal{B}(W\rightarrow\ell) = 10.8\%$ using values consistent with the
average values listed in the PDG~\cite{Patrignani:2016xqp}.  The tau
decay modes diverge slightly from the values listed in the PDG as can be
seen in Table~\ref{tab:tau_br}.  The impact of this on the branching
fraction determination is estimated and included as a systematic
uncertainty.

\begin{table}[h]
    \centering
    \begin{tabular}{l|cc}
        decay                                & simulation & PDG       \\
        \hline
        $e$                                  & 0.17728    & 0.1782(4) \\
        $\mu$                                & 0.17311    & 0.1739(4) \\
        $\pi^{\pm}$                          & 0.10768    & 0.1082(5) \\
        $\pi^{\pm}\pi^{0}$                   & 0.25374    & 0.2549(9) \\
        $\pi^{\pm}\pi^{0}\pi^{0}$            & 0.09247    & 0.0926(10) \\
        $\pi^{\pm}\pi^{\pm}\pi^{\mp}$        & 0.09257    & 0.0931(5) \\
        $\pi^{\pm}\pi^{\pm}\pi^{\mp}\pi^{0}$ & 0.04594    & 0.0462(5) \\
        5 prong                              & ?          & $9.9(4)\times 10^{-4}$ \\
    \end{tabular}
    \caption{Comparison of $\tau$ lepton branching fractions used in
    simulation of its decays and those listed in the PDG.}
\end{table}

\emph{Add description of generators, etc.}

Simulated samples are reweighted to account for differences in
reconstruction and identification efficiencies of the physics objects of
interest.  Details of these as well as other object specific corrections 
are presented in section~\ref{sec:objects}.

\subsubsection{Pileup}
\label{sec:pileup}

Differences between the pileup distribution used in simulation and data
is corrected by reweighting the simulation according to the weights
shown in figure~\ref{fig:pileup}.  The weight is applied based on the
number of pileup, including out-of-time pileup, per event.  This process
can be validated by comparing the number of reconstructed primary
vertices in data and simulation as shown in figure~\ref{fig:npv}.  There
is still a sizeable discrepancy between the distributions.  This has
been widely observed within CMS and no additional measures are taken to
address this.


\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{figures/pileup_systematics}
    \caption{(\emph{top}) Pileup distribution in data and simulation
    including the $\pm\sigma$ variation of the data pileup
    distributions.  (\emph{bottom}) The weights parameterized by number
    of simulated pileup resulting from taking the ratio of the pileup
    distribution in data and simulation.
    \label{fig:pileup}
    }
\end{figure}

\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{figures/n_pv}
    \caption{Comparison of primary vertex multiplicity between data and
    simulated datasets.
    \label{fig:npv}
    }
\end{figure}

\FloatBarrier
\subsection{top quark \pt reweighting}
\label{sec:top_pt}

Additional corrections can be applied to the \ttbar sample to account
for generator level mismodeling of the top quark \pt
spectrum~\cite{CMS-PAS-TOP-16-011, CMS-PAS-TOP-16-008}.  This is done by
identifying the parton-level top quarks, and calculating a scale factor
from the equation,

\begin{equation}
\nonumber
    SF_{t}(\pt) = SF_{\bar{t}}(\pt) = e^{0.0615-0.0005 \pt}.
\end{equation}

The overall event weight is that is applied is $w =
\sqrt{SF_{t}SF_{\bar{t}}}$.  For this analysis, we do not apply the
weight, but instead include the affect of applying the weight to
generate a one-sided morphing template used in the branching
fraction determination.  In this case, the nominal value corresponds to
the central value of a one-sided Gaussian constraint and the weighted
value corresponds to the one-sigma variation up.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.55\textwidth]{figures/top_pt_weight}
    \caption{Comparison of the trailing lepton $\pt$ distribution in
        $e\mu$ events with at least two jets and at least one b tag with
        top $\pt$ weights applied and without the weights.
        \label{fig:top_pt_weight}
    } 
\end{figure}

\subsection{WW \pt reweighting}
\label{sec:ww_pt}

Estimation of the $WW$ process relies on the \POWHEG MC generator which is a
NLO fixed order generator.  Higher order corrections are therefore not directly
included, but have been calculated separately~\cite{Meade:2014fca,
Jaiswal:2014yba, Grazzini:2015wpa}.  The estimation of uncertainty is based on
the description in section 6 of AN-2017-273.  As mentioned there, the
theoretical uncertainty associated with the corrections have not been provided
so they are estimated by varying the renormalization, factorization, and the
matching scale of the \pt resummation technique.  The weights and their
systematic variations, as well as the effect on the lepton \pt spectrum in the
WW MC sample is shown in figure~\ref{fig:ww_weight}.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.45\textwidth]{figures/systematics/ww_pt_lepton_pt}
    \includegraphics[width=0.45\textwidth]{figures/systematics/ww_pt_weight_variations}
    \caption{\emph{left.} Weights for the $qq\rightarrow WW$ process as
        a function of the $WW\,\pt$ and the two componnents of
        systematic variation.  \emph{right.} Trailing lepton pt from the $qq\rightarrow
        WW\rightarrow e\mu\nu\nu$ simulated sample when there are no
        reconstructed jets.
        \label{fig:ww_weight}
    } 
\end{figure}

\subsection{Z \pt reweighting}

Based on differences between the observed and predicted \PZ \pt
spectrums, weights are derived to correct the \pt spectrum in
simulation.  The derivation of the weights was done in the context of
the $H\rightarrow WW$ analysis and is described in AN-2017-082.  This
correction does not have an associated uncertainty included in the fit.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.45\textwidth]{figures/z_pt_weighting}
    \caption{\emph{top.} Comparison of weighted and unweighted dilepton
        \pt spectrum for dimuon events with two jets and no b tags.
        \emph{bottom.} Comparison between ration of distributions in the
        top distribution and the analytical function for generating
        weights.
        \label{fig:ww_weight}
    } 
\end{figure}
