\section{Selection}
\label{sec:analysis:selection}



\subsection{Object Selection}
\label{sec:analysis:selection:object}

The event topologies of interest will require reconstructing electrons, muons, hadronically decaying tau leptons, hadronic jets, \PQb tagged jets, and missing tansverse energy (\MET or MET).  In this section, the reconstruction and selection of these physics objects is described.



\subsubsection{Primary vertex}
Primary vertices (PV) are reconstructed based on information from the tracking subsystem, mainly through the inner pixel detector. Quality cuts are applied to reconstructed PVs to guarantee they come from a proton-proton hard scattering event. These cuts are as follows,
\begin{equation*}
    N_{\rm d.o.f.}> 4; \quad  \left|z\right| < 24\cm; \quad \sqrt{x^{2} + y^{2}} < 2\cm.
\end{equation*}


\noindent The PVs are ordered based on the sum \pt of their reconstructed tracks. Selected physics objects are associated to the PV with the greatest sum \pt. 




\subsubsection{Muon}
Muon candidates are reconstructed using both the muon and tracker systems. The coverage of these two detector systems allows reconstruction of muons within $\left|\eta\right| < 2.4$ and $p_{T}$ as low as 5\GeV~\cite{Chatrchyan:2012xi}. The details of particle-flow muon reconstruction are described in Section~\ref{sec:cmsExperiment:reconstruction:muon}. In the analysis, selected muons are required to be reconstructed using both the \emph{global} muon and \emph{tracker} muon reconstruction algorithms. The former begins with tracker information and extrapolates to find consistency with hits in the muons system, while the latter inverts the reconstruction steps starting from the muon system and finding tracks that are consistent. The combination of these two algorithms makes for a muon reconstruction that is accurate in predicting muon momentum and efficient in detecting muons within the detector acceptance.

In the interest of detecting muons decaying from vector bosons, a set of identification and isolation requirements are applied~\cite{Sirunyan:2018fpa}. The muon identification requirements are designed to have high selection efficiency and a low probability of misidentifying non-prompt muons originating from non-bosonic decays. The selection criteria provided by the muon Physics Object Group (POG) are listed in Table~\ref{tab:analysis:selection:muon_id}.

\input{chapters/Analysis/sectionSelection/tables/muonSelection.tex}

\noindent To increase the likelihood of selecting muons produced by the prompt decay of vector bosons, an isolation requirement is placed on all muons. The isolation of the muon is calculated by summing the \pt of all charged hadronic, neutral hadronic, and photon particle flow candidates in a cone of radius $\Delta R = 0.4$ about the muon candidate. This quantity is corrected to remove the contamination of the neutral component due to pileup by subtracting off the average energy deposited by pileup. It is defined as,
\begin{equation*} 
    Iso_\mathrm{PF} = Iso_\mathrm{ ch. had} + \max\left(0, Iso_\mathrm{ neu. had} + Iso_{\gamma} - 0.5 Iso_\mathrm{ pileup}\right)\,.
\end{equation*}








\subsubsection{Electron}

Electrons are reconstructed by combining information from the electromagnetic calorimeter and the tracking system using a gaussian-sum filter (GSF) method \cite{Baffioni:2006cd}. The details of the particle-flow electron reconstruction are described in Section~\ref{sec:cmsExperiment:reconstruction:egamma}. All electrons are required to have $\pt \geq 20 \GeV$ and $|\eta| < 2.5$.  Electrons are identified using a tight cut-based scheme. The requirements for this selection are listed in Table~\ref{tab:analysis:selection:electron_id}.

\input{chapters/Analysis/sectionSelection/tables/electronSelection.tex}

\noindent The electrons are also required to pass a tight isolation criteria. The isolation variable is constructed by summing the energy of charged and neutral particle flow objects within a cone of radius $\Delta R = 0.4$ about the electron candidate and subtracting off the contribution from pileup.  The combined particle flow isolation with the pileup correction is,
\begin{equation*}
    Iso_\mathrm{comb} = Iso_\mathrm{ ch. had.} + \max\left(0, Iso_\mathrm{ neu. had.} + Iso_{\gamma} - \rho A_\mathrm{eff}(\abs{\eta_{\Pe}}) \right)\,,
\end{equation*}
\noindent The pileup correction is dependent on the parameter $\rho$ which correlates with the average energy due to pileup, and the effective area which changes depending on the $|\eta|$ value of the electron.





\subsubsection{Hadronic Tau}

Hadronically decaying tau leptons are reconstructed using the hadron-plus-strips algorithm~\cite{ref:cms-tau}. This algorithm constructs candidates seeded by a PF jet that are consistent with either a single or triple charged pion decay of the tau lepton.  In the single charged pion decay mode, the presence of neutral pions is detected by reconstructing their photonic decays. The details of the hadronic tau identification is described in Section~\ref{sec:cmsExperiment:reconstruction:tau}. 

Reconstructed hadronic taus are required to have $p_{T} > 20\GeV$ and $|\eta| < 2.3$ unless noted otherwise.  If the hadronic tau candidate is found to overlap ($\DR < 0.3$) with either an electron or muon passing the analysis selections listed above, the tau candidate is rejected. To reduce fakes from electrons and muons that do not pass the analysis selections listed above, MVA discriminators are applied, which requires VTight electron rejection working point and Tight muon rejection working point. Jets originating from non-tau decays are rejected with a MVA discriminator that takes into account the pileup contribution to the neutral component of the tau decay~\cite{CMS-TAU-16-003-001}.  It is observed that the counting analysis is more sensitive to contamination from by hadronic jets. So while the tight working point is used in the shape analysis, the very tight working point is used for the counting analysis. 








\subsubsection{Jet}
Jets are reconstructed from particle-flow (PF) candidates \cite{ref:pf}. PF candidates combine information from all of the detector subsystems to facilitate the reconstruction and identification of individual particles.  These PF candidates are clustered using the anti-\kt algorigthm \cite{Cacciari:2008gp} with a cone size of $\DR = 0.4$. Once reconstructed, a number of corrections are applied to the jets to correct for pileup contamination, differing absolute response in jet \pt, and relative response in $\eta$ \cite{ref:jetscale}.  To reduce contamination from photons and prompt leptons, several ID requirements are placed on the jets and are listed in Table~\ref{tab:analysis:selection:jet_id_2016}.

\input{chapters/Analysis/sectionSelection/tables/jetSelection.tex}

\noindent In addition to the above requirements, it is required that all jets have $\pt > 30\GeV$ and $|\eta| < 4.7$.  Jets are vetoed if they overlap with a muon, electron, or tau passing the identification requirements described above within a cone size of $\Delta R = 0.3$. 

\subsubsection{$\mathrm{b}$ Tag} The identification of jets originating from the decay of \PQb quarks is done using the CSV \PQb tagging algorithm~\cite{Sirunyan:2298594} is used to optimize the efficiency for identifying \PQb jets while reducing the misidentification from jets originating from light quarks. Details of the \PQb tagging algorithms are described in section~\ref{sec:cmsExperiment:reconstruction:btag}.  In this analysis, the recommended medium working point ($\text{CSV} > 0.8484$) supplied by the \PQb tag POG is used. 




\subsubsection{Summary}

Table~\ref{tab:analysis:selection:ObjectSelectionSum} gives a summary of the selection of physics objects, including electrons, muons, taus, jets and \PQb tags. The corrections and calibrations of the physics objects are described in Section~\ref{sec:analysis:calibration:objects}.




\begin{table}[ht]
    \centering
    \setlength{\tabcolsep}{0.8em}
    \renewcommand{\arraystretch}{1.5}
    % \small
    \caption{Summary of object selection. For \PGth, sh
    ape (counting) analysis uses Tight (VTight) working points of \PGth isolation MVA.}
    \label{tab:analysis:selection:ObjectSelectionSum}
    \input{chapters/Analysis/sectionSelection/tables/objectSelectionSummary}
\end{table}


\FloatBarrier

% ===========================
% Event Selection
% ===========================
\subsection{Event Selection}
\label{sec:analysis:selection:event}

The event selection begins by requiring an event pass the lowest \pt threshold single electron or muon trigger that is not prescaled. From these datasets it is possible to select events based on the number of \WW-like final states originating from \ttbar and \tW production.  These final states are constructed based on the number of reconstructed leptons, jet multiplicity, and \PQb tag multiplicity.  The categorization of these events differs between the counting and shape analysis.  The common definition of the categories are listed in Table~\ref{tab:analysis:selection:event_categories}. There are eight channels defined by the multiplicities of leptons: 
\begin{itemize}
    \item \cee, \cem, \cet, \ceh channels based on single electron trigger; 
    \item \cme, \cmm, \cmt, \cmh channels based on the single muon trigger.
\end{itemize}
\noindent In addition, $n_j$ and $n_\PQb$ requirements are applied to further partition these eight channels, which are illustrated in Table~\ref{tab:analysis:selection:jet_categories}. These selections are designed primarily to target \ttbar production and specific \PW decay modes. The final states will tend to contain only events from a single datastream except for the \cem selection which has non-negligible overlap between the electron and muon datastreams. Any overlap in events between the two datastreams are removed by only taking the events from single muon datastream. The shape analysis merges \cem and \cme channel, while the counting analysis keeps the two separated, requiring additionally $\pt^\Pe  >(<) \pt^\PGm$ in \cem (\cme) if an event satisfies both channel.



\begin{table}
    \caption{Baseline categorization of events based on the triggering electron or muon, the presence of isolated reconstructed charged leptons.}
    % plus additional jets, identified or not as originating from a \PQb quark. Kinematic criteria required on the charged leptons and jets are listed in the last column. Categories without hadrons in the final state require also the selected leptons to have opposite-sign (OS) charge. %Overlap between events that are collected in both electron and muon triggered data streams is properly accounted for.
    \label{tab:analysis:selection:event_categories}
    \centering                                                              
    \renewcommand{\arraystretch}{1.8}           
    \setlength{\tabcolsep}{0.5em}
    % \resizebox{0.9\textwidth}{!}{                                           
    \input{chapters/Analysis/sectionSelection/tables/eventCatagory}
    % }                                                          
\end{table}


\begin{table}[]
    \centering
    \setlength{\tabcolsep}{0.6em}
    \renewcommand{\arraystretch}{1.5}
    \caption{Categorization of the events with electron, muon, and/or tau leptons passing the reconstruction criteria, based on their jet and \PQb-tagged jet multiplicities. The yellow cells are the regions Incorporated in the shape analysis only. Also shape analysis splits $n_j=2$ and $n_j\geq 3$ regions for \cet and \cmt channels, shown as the yellow lines.}
    \input{chapters/Analysis/sectionSelection/tables/eventCatagoryJet}
    
    \label{tab:analysis:selection:jet_categories}
\end{table}





% For the counting analysis, there is always a requirement that there be at least two jets and at least one \PQb tagged jet. The categories are partitioned based on whether there is exactly one \PQb jet or there are two or more \PQb jets. Additionally, the \cem selection is split into muon triggered and electron triggered categories: if the muon has the highest \pt and the muon trigger has fired it categorized as a \cme event; if the electron has highest \pt and the electron trigger fired it is categorized as an \cem event.


The additional subdivisions of the dataset in the shape analysis are illustrated as yellow cells and lines in Table~\ref{tab:analysis:selection:jet_categories}. These lower jet multiplicity and lower \PQb tag multiplicity regions function as control regions to constrain systematic uncertainties, thus takes some special event selection requirement than Table~\ref{tab:analysis:selection:event_categories}. As described in the list above, the \cee and \cmm categories have a \PZ veto applied in the case that there are one or more \PQb tags; this requirement is not applied in the zero \PQb tag case.  There is also a set of requirements to enhance the proportion of Drell-Yan in the \cet and \cmt categories in the case that the number of jets is zero or one and there are no \PQb tags.  The requirements are designed to reduce the \wjets contribution and are:
\begin{equation*}
    40 \GeV \leq m_{\ell\PGt_{h}} \leq 100 \GeV, \quad \Delta\phi(\ell, \PGt_{h}) > 2.5, \quad m_{\rm T}^{\ell, MET} < 60 \GeV,
\end{equation*}

\noindent where $m_{T}^{\ell, MET} $ is the transverse mass of the electron or muon,
\begin{equation}
\label{eq:trans_mass}
    m_{T}^{\ell, MET} = \sqrt{2 \pt^{\ell}\MET (1-\cos\Delta\phi(\pt^{\ell}, \MET))}.
\end{equation}


\subsubsection{Yields and Kinematics Distributions}
For the shape analysis, the yields are shown in Tables~\ref{tab:analysis:selection:yieldsShape1} and \ref{tab:analysis:selection:yieldsShape2}. The kinematics distributions are included in Appendix~\ref{sec:analysis:plots:shape}. For counting analysis, the yields are shown in Table~\ref{tab:analysis:selection:yieldsCounting}. The kinematics distributions are included in Appendix~\ref{sec:analysis:plots:counting}.



\subsubsection{Leptons from Boson Decays and Tau Decays} 
Because the tau can decay to an electron, muon, or hadronically, each of these channels has some mixing between terms arising from $\PW\rightarrow\ell$ decays and $\PW\rightarrow\PGt\rightarrow\ell$ decays.  The mixing between the selected final states and the underlying \PW boson decays are shown in Table~\ref{tab:analysis:selection:signal_breakdown}. These numbers are estimated from simulated \ttbar events and are consequently dependent on the values of branching fractions used in the simulation. The expected proportions of $\PW\rightarrow\ell$ decays and $\PW\rightarrow\PGt\rightarrow\ell$ decay in the selected sample can be studied by calculating the signal-over-background ratio. For \cmm channel, the distributions of the tailing muon \pt and impact parameter are shown in Figure~\ref{fig:analysis:selection:sob_mumu_lep2_pt}. In the lower plots in Figure~\ref{fig:analysis:selection:sob_mumu_lep2_pt}, the ratios between $\ttbar/\tW \to \PGm \PGt \to \PGm \PGm$ and other simulations are shown as orange dots, while the ratios between $\ttbar/\tW \to \PGm \PGm$ and other simulations are shown as blue dots. The ratios are calculated as function of the tailing muon \pt and impact parameter, shown on the left and right, respectively. Both the variables show significant discrimination of prompt muons directly from \PW decays against non-prompt muons from tau decays.

 \begin{figure}[h]
  \centering
  \includegraphics[width=0.49\textwidth]{chapters/Analysis/sectionPlots/figures/kinematics_pickles/mumu/12b/mumu_2b_lepton2_pt.pdf}
  \includegraphics[width=0.49\textwidth]{chapters/Analysis/sectionSelection/figures/sob/mumu_lepton2_d0_logscale.pdf}
  \includegraphics[width=0.49\textwidth]{chapters/Analysis/sectionSelection/figures/sob/mumu_lepton2_pt_2.pdf} 
  \includegraphics[width=0.49\textwidth]{chapters/Analysis/sectionSelection/figures/sob/mumu_lepton2_d0_2.pdf} 
  \caption{The distributions of the tailing muon \pt (\emph{upper left}) and impact parameter (\emph{upper right}). The ratios between $\ttbar/\tW \to \PGm \PGt \to \PGm \PGm$ and other simulations are shown as orange dots, while the ratios between $\ttbar/\tW \to \PGm \PGm$ and other simulations are shown as blue dots, as function of the tailing muon \pt (\emph{lower left}) and impact parameter (\emph{lower right}).
  \label{fig:analysis:selection:sob_mumu_lep2_pt}}
\end{figure}


% ----MARK finetuning ---
\subsubsection{Trigger Status of Dilepton Events} 
In dilepton channels \cee, \cmm, \cem, \cme, at least one of leading and trailing lepton is required to pass the single lepton trigger. It is possible that in some events, it is only the trailing lepton that fires the single lepton trigger, while the leading lepton does not. In such scenario, the modeling of trigger efficiencies has a more direct impact to the kinematics of the trailing lepton, which used for the shape analysis.  To understand the contribution of such scenario in the selected dataset, a trigger test study is conducted to calculate the proportions of events with both leptons firing, only leading lepton firing, and only trailing lepton firing. Figure~\ref{fig:analysis:selection:trTest} shows the proportions as function of the trailing lepton \pt in the \cmm, \cee, \cme, \cem channel. This is done by matching the leading and trailing lepton to the save triggering objects of single muon or electron HLT. The green lines and areas represent the data and simulation respectively of only trailing lepton firing the trigger, which have small contributions and good data-simulation agreements in \cee, \cmm channel.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.99\textwidth]{chapters/Analysis/sectionSelection/figures/trTest.png}
  \caption{trailing lepton \pt in the \cmm,\cee,\cme,\cem channel. Data and MC events channel are split based on the trigger test of leading and trailing lepton: blue for both leptons firing trigger, orange for only leading lepton firing trigger, green for only trailing lepton firing trigger, red for neither leptons firing trigger. The lines are for data and the filled areas are for simulation.
  \label{fig:analysis:selection:trTest}}
\end{figure}






 

 
 
 
 







% Events are split based on the trigger test of the leading and trailing lepton, which has four possible scenarios, both pass (blue), only leading pass (orange), only trailing pass (green), both fail (red). But the case of both fail should not appear due the event selection requirement. The scenario needs attention is only the trailing lepton triggering the event. Since the shape analysis template fits the trailing lepton \pt in the dilepton channel, it is good to know the contributions from such scenario and decide whether extra treatment of trigger systematics is needed.









% \input{chapters/Analysis/sectionSelection/tables/eventSelection.tex}



\begin{sidewaystable}[ht]
    \centering
    \setlength{\tabcolsep}{0.4em}
    \renewcommand{\arraystretch}{1.5}

    \caption{Composition of accepted \ttbar and \tW events, breakdown by 21 \WW decay modes.  Values are in percent.}
    \resizebox{\textwidth}{!}{\input{chapters/Analysis/sectionSelection/tables/sigcomp.tex}}
    \label{tab:analysis:selection:signal_breakdown}
    
\end{sidewaystable}




\begin{sidewaystable}
    \centering
    \setlength{\tabcolsep}{0.2em}
    \renewcommand{\arraystretch}{1.5}
    
    \caption{Estimates of the yields for various processes in the \cee,
    \cmm, \cem and \ceh, \cmh final states broken down by the
    number of \PQb tags.  The estimate of the expected yield is compared to
    the yield observed from data.  Uncertainties are statistical plus
    variation from luminosity and normalization uncertainties.}
    \resizebox{\textwidth}{!}{\input{chapters/Analysis/sectionSelection/tables/yieldsShape1}}
    \label{tab:analysis:selection:yieldsShape1}
\end{sidewaystable}


\begin{sidewaystable}[]
    \centering
    \setlength{\tabcolsep}{0.4em}
    \renewcommand{\arraystretch}{2}
    
    \caption{Estimates of the yields for various processes in
    the \cet and \cmh categories broken down by the number of \PQb tags.
    The estimate of the expected yield is compared to the yield observed
    from data.  Uncertainties are statistical only.}
    
    \resizebox{\textwidth}{!}{\input{chapters/Analysis/sectionSelection/tables/yieldsShape2}}
    \label{tab:analysis:selection:yieldsShape2}
\end{sidewaystable}




\begin{sidewaystable}
    \centering
    \setlength{\tabcolsep}{0.4em}
    \renewcommand{\arraystretch}{2}
    \caption{Estimates of the yields. The estimate of the expected yield is compared to the yield observed from data.  Uncertainties are statistical only.
    \label{tab:analysis:selection:yieldsCounting}}
    \resizebox{\textwidth}{!}{\input{chapters/Analysis/sectionSelection/tables/yieldsCounting}}
\end{sidewaystable}



\FloatBarrier


